<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack 5 Module Federation: JavaScript 架构的变革者 | RichLab</title>
    <meta name="description" content="Webpack 5 新特性 —— Module Federation, 让 JavaScript 应用得以在客户端或服务器上动态运行另一个 bundle 或者 build 的代码。">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="https://gw.alipayobjects.com/zos/finxbff/compress-tinypng/7a6ec1c9-2680-4817-8748-eeab10cb1469.png">
  <meta name="referrer" content="no-referrer">
  <meta name="theme-color" content="#272727">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="alternate" type="application/rss+xml" href="https://richlab.design/rss.xml" title="RichLab RSS Feed">
    
    <link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/css/0.styles.886df434.css" as="style"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/app.07ace312.js" as="script"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/6.7e6d8c60.js" as="script"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/1.99a6a48f.js" as="script"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/8.c2ec29c0.js" as="script"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/14.0d652d66.js" as="script"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/12.edba1657.js" as="script"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/10.2e0e5e04.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/11.be43795f.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/13.3b3cf6c6.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/15.93707703.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/16.d0e74feb.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/17.6f3885e2.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/18.1c8b31d1.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/19.3c32bdec.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/20.45f017b7.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/21.f9b2684e.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/22.27a6451f.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/23.8afa376f.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/24.814c7733.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/25.2e37eb95.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/26.2f278a56.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/27.10df3baf.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/28.dc8dbc9b.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/29.8e4a071e.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/4.07cd07bc.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/5.577decc2.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/7.594a115c.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/9.e3b897c3.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/vuejs-paginate.582006e0.js">
    <link rel="stylesheet" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/css/0.styles.886df434.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container layout-post"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://gw.alipayobjects.com/zos/finxbff/compress-tinypng/b1a25d04-6a13-4bb5-a929-a5f0db08b8de.png" alt="RichLab" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/blog/" class="nav-link">Blog</a></div><div class="nav-item"><a href="/translations/" class="nav-link router-link-active">Translations</a></div><div class="nav-item"><a href="/team/" class="nav-link">Team</a></div><div class="nav-item"><a href="https://github.com/rich-lab" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></div> <!----></nav> <a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#111" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path> <path d="M4 4a16 16 0 0 1 16 16"></path> <circle cx="5" cy="19" r="1"></circle></svg></a></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/blog/" class="nav-link">Blog</a></div><div class="nav-item"><a href="/translations/" class="nav-link router-link-active">Translations</a></div><div class="nav-item"><a href="/team/" class="nav-link">Team</a></div><div class="nav-item"><a href="https://github.com/rich-lab" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Webpack 5 Module Federation: JavaScript 架构的变革者</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/translations/2020/03/27/webpack-5-module-federation/#那么什么是-module-federation" class="sidebar-link">那么什么是 Module Federation?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/translations/2020/03/27/webpack-5-module-federation/#术语" class="sidebar-link">术语</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/translations/2020/03/27/webpack-5-module-federation/#构建一个-federated-application" class="sidebar-link">构建一个 federated application</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/translations/2020/03/27/webpack-5-module-federation/#app-one" class="sidebar-link">App One</a></li><li class="sidebar-sub-header"><a href="/translations/2020/03/27/webpack-5-module-federation/#app-two" class="sidebar-link">App Two</a></li><li class="sidebar-sub-header"><a href="/translations/2020/03/27/webpack-5-module-federation/#app-three" class="sidebar-link">App Three</a></li></ul></li><li><a href="/translations/2020/03/27/webpack-5-module-federation/#浏览器中的最终结果（不同于第一个视频）" class="sidebar-link">浏览器中的最终结果（不同于第一个视频）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/translations/2020/03/27/webpack-5-module-federation/#代码冗余" class="sidebar-link">代码冗余</a></li></ul></li><li><a href="/translations/2020/03/27/webpack-5-module-federation/#服务端渲染" class="sidebar-link">服务端渲染</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/translations/2020/03/27/webpack-5-module-federation/#federated-next-js-on-webpack-5" class="sidebar-link">Federated Next.js on Webpack 5</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/translations/2020/03/27/webpack-5-module-federation/#talks-podcasts-or-feedback" class="sidebar-link">Talks, podcasts, or feedback</a></li></ul></li><li><a href="/translations/2020/03/27/webpack-5-module-federation/#使用-module-federation-的例子" class="sidebar-link">使用 Module Federation 的例子</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"><div><div class="author-wrapper"><div class="authors"><div class="author"><span class="type-text">Translated by</span> <a href="https://github.com/ulivz" target="_blank" class="author-image"><img src="/authors/ulivz.png" alt="ulivz"></a></div><div class="author"><span class="type-text">Revised by</span> <a href="https://github.com/jothy1023" target="_blank" class="author-image"><img src="/authors/jothy1023.png" alt="jothy1023"></a></div></div></div></div> <div class="theme-default-content content__default"><h1 id="webpack-5-module-federation-javascript-架构的变革者"><a href="#webpack-5-module-federation-javascript-架构的变革者" class="header-anchor">#</a> Webpack 5 Module Federation: JavaScript 架构的变革者</h1> <p>Module Federation <code style="font-family:Arail;"><i>[ˌfedəˈreɪʃn]</i></code> 使 JavaScript 应用得以在客户端或服务器上动态运行另一个 bundle 或者 build 的代码。</p> <blockquote><p>原文：<a href="https://medium.com/@ScriptedAlchemy/webpack-5-module-federation-a-game-changer-to-javascript-architecture-bcdd30e02669" target="_blank" rel="noopener noreferrer">Webpack 5 Module Federation: A game-changer in JavaScript architecture<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <hr> <p><strong>Module Federation 之于 JavaScript Bundler，如同 Apollo 之于 GraphQL。</strong></p> <blockquote><p>在独立的应用之间共享代码的可伸缩解决方案从未如此方便，而且几乎不可能大规模实现。此前我们拥有的最成熟方案是 externals 或 DLLPlugin，它们强制把依赖集中于一个外部文件中。共享代码真的很麻烦，因为很多应用看似独立，却不是真正意义上的独立，可共享的依赖非常有限。此外，在单独打包的 Web 应用之间共享实际的特性代码往往并不可行、<strong>无效</strong>、且毫无益处。</p></blockquote> <h2 id="那么什么是-module-federation"><a href="#那么什么是-module-federation" class="header-anchor">#</a> 那么什么是 Module Federation?</h2> <p>这是我发明并且赋予它最初形态的 JavaScript 架构，在我的联合创作者兼 Webpack 创始人的帮助下，它成为了 Webpack 5 Core 中最令人兴奋的功能之一（Webpack 5 有一堆很酷的东西，新的 API 强大又干净）。</p> <blockquote class="highlight"><p>我非常荣幸地向大家介绍 JavaScript 应用架构中的一个期待已久的飞跃，我们对于开源社区的贡献：Module Federation。</p></blockquote> <p>Module Federation 使 JavaScript 应用得以从另一个 JavaScript 应用中动态地加载代码 —— 同时共享依赖。如果某应用所消费的 federated module 没有 federated code 中所需的依赖，Webpack 将会从 federated 构建源中下载缺少的依赖项。</p> <p>代码是可以共享的，但每种情况都有降级方案。federated code 可以总是加载自己的依赖，但在下载前会去尝试使用消费者的依赖。更少的代码冗余，依赖共享就像一个单一的 Webpack 构建。虽然我已经实现了这个最初的系统——他是由我自己（<a href="https://medium.com/@ScriptedAlchemy" target="_blank" rel="noopener noreferrer">Zack Jackson<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）和 <a href="https://medium.com/@maraisr" target="_blank" rel="noopener noreferrer">Marais Rossouw<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 在 <a href="https://medium.com/@sokra" target="_blank" rel="noopener noreferrer">Tobias Koppers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的悉心帮助和结对编程下完成的。这些开发者们在 Webpack 5 的核心重写和稳定化上起着关键性的作用，谢谢你们一直以来的合作和支持。</p> <h2 id="术语"><a href="#术语" class="header-anchor">#</a> 术语</h2> <p align="center"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/main.50bee209.png" width="400"></p> <ul><li><p><strong>Module federation</strong>: 与 Apollo GraphQL federation 的想法相同 —— 但适用于在浏览器或者 Node.js 中运行的 JavaScript 模块。</p></li> <li><p><strong>host</strong>：在页面加载过程中（当 <code>onLoad</code> 事件被触发）最先被初始化的 Webpack 构建；</p></li> <li><p><strong>remote</strong>：部分被 <strong>“host”</strong> 消费的另一个 Webpack 构建；</p></li> <li><p><strong>Bidirectional（双向的） hosts</strong>：当一个 bundle 或者 webpack build 作为一个 <code>host</code> 或 <code>remote</code> 运行时，它要么消费其他应用，要么被其他应用消费——均发生在运行时(runtime)。</p></li></ul> <p>如果你想更好地理解这篇文章，欢迎阅读<a href="https://medium.com/@jherr" target="_blank" rel="noopener noreferrer">Jack Herrington<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 写的文章!</p> <p align="center"><iframe width="100%" height="315" src="https://www.youtube.com/embed/D3XYAx30CNc" frameborder="1" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></p> <blockquote class="highlight"><p>值得注意的是，该系统的设计使每个完全独立的构建/应用都可以存放在自己的仓库中，独立部署，并作为独立的 SPA 运行。</p></blockquote> <p>这些应用都是 <strong>bidirectional（双向的） hosts</strong>. 所有在你修改路由或者移动应用时率先加载的应用都将成为 host, 它会像你实现 dynamic imports 一样加载 federated modules. 不过，如果你要刷新页面，则任何在之后的 load 中率先启动的应用，都将成为一个 host。</p> <p align="center" class="card-link"><a target="_blank" href="https://twitter.com/kmsaldana1/status/1234551387398103043?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed&amp;ref_url=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Ftype%3Dtext%252Fhtml%26key%3Da19fcc184b9711e1b4764040d3dc5c07%26schema%3Dtwitter%26url%3Dhttps%253A%2F%2Ftwitter.com%2Fkmsaldana1%2Fstatus%2F1234551387398103043%26image%3Dhttps%253A%2F%2Fi.embed.ly%2F1%2Fimage%253Furl%253Dhttps%25253A%25252F%25252Fpbs.twimg.com%25252Fprofile_images%25252F1016423846809722880%25252FJyBot7JY_400x400.jpg%2526key%253Da19fcc184b9711e1b4764040d3dc5c07"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/kevin-saldana-tweet.dd3638e9.png" width="500"></a></p> <p>假设一个网站的每个页面都是独立部署和编译的，我想要这种微前端风格的架构，但不希望页面随着我更改路由而重新加载。我还希望在页面之间动态地共享代码和 vendors, 这样它就像支持 code splitting 的大型 Webpack 构建般高效了。</p> <p>访问应用的 home 也将会使这个 “home” 页成为 “host”，如果你切换到 “about” 页，那么这个 host（home 页的 spa）实际上是从另一个独立应用（about 页的 spa）中动态加载一个模块，它并不会加载应用主入口以及另一个完整的应用，<strong>而只会加载几千字节的代码</strong>。如果我在 “about” 页刷新浏览器，“about” 页将会成为 “host”，此时我回到 “home” 页，“about” 页（“host”）将会从 “remote” 获取运行时的一些片段——这个 “remote” 就是 “home” 页。在这个系统中，所有的应用都既是 “remote” 又是 “host”，与其它 federated module 互为消费者与被消费者。</p> <p>你可以在 Github 上找到更多的技术细节：</p> <p><a href="https://medium.com/@ScriptedAlchemy/webpack-5-module-federation-a-game-changer-to-javascript-architecture-bcdd30e02669" target="_blank" rel="noopener noreferrer">Merge Proposal: Module federation and code sharing between bundles. Many builds act as one<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="构建一个-federated-application"><a href="#构建一个-federated-application" class="header-anchor">#</a> 构建一个 federated application</h2> <p>让我们从三个独立的应用入手。</p> <h3 id="app-one"><a href="#app-one" class="header-anchor">#</a> App One</h3> <h4 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h4> <p>我将使用 <strong>App One</strong> 中的应用容器 <code>&lt;App&gt;</code>，它将会被另一个应用消费，为此，我把 App expose 为 AppContainer，<strong>App One</strong> 将会同时消费来自另外两个 federated applications 中的组件，为此，我指定了 <code>remotes</code> scope：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ModuleFederationPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack/lib/container/ModuleFederationPlugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// other webpack configs...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;app_one_remote&quot;</span><span class="token punctuation">,</span>
      remotes<span class="token operator">:</span> <span class="token punctuation">{</span>
        app_two<span class="token operator">:</span> <span class="token string">&quot;app_two_remote&quot;</span><span class="token punctuation">,</span>
        app_three<span class="token operator">:</span> <span class="token string">&quot;app_three_remote&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      exposes<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'AppContainer'</span><span class="token operator">:</span><span class="token string">'./src/App'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      shared<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">&quot;./public/index.html&quot;</span><span class="token punctuation">,</span>
      chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="设定构建编排流程"><a href="#设定构建编排流程" class="header-anchor">#</a> 设定构建编排流程</h4> <p>在应用的头部，我加载了 <code>app_one_remote.js</code> —— 来让当前的应用连接到其他 Webpack runtimes，并在运行时提供一个编排层（orchestration layer），这是一个专门设计的 Webpack runtime 和 entry point，<strong>但它不是一个普通的应用 entry point，并且只有几 KB</strong>。</p> <p><strong>要注意，这些特殊的 entry points 大小只有几 KB——它们包含一个可以与 host 连接的特殊的 Webpack runtime，它们并非标准的 entry point。</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://localhost:3002/app_one_remote.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://localhost:3003/app_two_remote.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="从-remote-消费代码"><a href="#从-remote-消费代码" class="header-anchor">#</a> 从 remote 消费代码</h4> <p><strong>App One</strong> 中有个 Page1 页面消费了 <strong>App Two</strong> 的 dialog 组件：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> Dialog <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;app_two_remote/Dialog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Page1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Page 1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">React.Suspense</span></span> <span class="token attr-name">fallback</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Loading Material UI Dialog...<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Dialog</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">React.Suspense</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Page1<span class="token punctuation">;</span>
</code></pre></div><p>路由看起来很标准：</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Route<span class="token punctuation">,</span> Switch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> Page1 <span class="token keyword">from</span> <span class="token string">&quot;./pages/page1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Page2 <span class="token keyword">from</span> <span class="token string">&quot;./pages/page2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Routes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/page1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Page1</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/page2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Page2</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Routes<span class="token punctuation">;</span>
</code></pre></div><p align="center" class="card-link"><a target="_blank" href="https://twitter.com/ScriptedAlchemy/status/1233646967944646657?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed&amp;ref_url=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Ftype%3Dtext%252Fhtml%26key%3Da19fcc184b9711e1b4764040d3dc5c07%26schema%3Dtwitter%26url%3Dhttps%253A%2F%2Ftwitter.com%2Fscriptedalchemy%2Fstatus%2F1233805740076224514%26image%3Dhttps%253A%2F%2Fi.embed.ly%2F1%2Fimage%253Furl%253Dhttps%25253A%25252F%25252Fpbs.twimg.com%25252Fprofile_images%25252F1006614185093091337%25252FOAPr0bpP_400x400.jpg%2526key%253Da19fcc184b9711e1b4764040d3dc5c07"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/zack-jackson-tweet.697f516e.png" width="500"></a></p> <h3 id="app-two"><a href="#app-two" class="header-anchor">#</a> App Two</h3> <h4 id="配置-2"><a href="#配置-2" class="header-anchor">#</a> 配置</h4> <p><strong>App Two</strong> 将会导出 Dialog，并让 <strong>App One</strong> 来消费它，<strong>App Two</strong> 将会同时消费 <strong>App One</strong> 的 <code>&lt;App&gt;</code> —— 因此我们把 <code>app_one</code> 页设置为 “remote”。演示一下 bi-directional hosts.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ModuleFederationPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack/lib/container/ModuleFederationPlugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;app_two_remote&quot;</span><span class="token punctuation">,</span>
      library<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;var&quot;</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&quot;app_two_remote&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;remoteEntry.js&quot;</span><span class="token punctuation">,</span>
      exposes<span class="token operator">:</span> <span class="token punctuation">{</span>
        Dialog<span class="token operator">:</span> <span class="token string">&quot;./src/Dialog&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      remotes<span class="token operator">:</span> <span class="token punctuation">{</span>
        app_one<span class="token operator">:</span> <span class="token string">&quot;app_one_remote&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      shared<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">&quot;./public/index.html&quot;</span><span class="token punctuation">,</span>
      chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="消费"><a href="#消费" class="header-anchor">#</a> 消费</h4> <p>这个是根 <code>App</code>：</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Routes <span class="token keyword">from</span> <span class="token string">'./Routes'</span>
<span class="token keyword">const</span> AppContainer <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;app_one_remote/AppContainer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">React.Suspense</span></span> <span class="token attr-name">fallback</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Loading App Container from Host<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AppContainer</span></span> <span class="token attr-name">routes</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Routes<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">React.Suspense</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p>这个是使用了 <code>Dialog</code> 的默认页面：</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>ThemeProvider<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@material-ui/core&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>theme<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./theme&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Dialog <span class="token keyword">from</span> <span class="token string">&quot;./Dialog&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MainPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ThemeProvider</span></span> <span class="token attr-name">theme</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Material UI App</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Dialog</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ThemeProvider</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MainPage
</code></pre></div><h3 id="app-three"><a href="#app-three" class="header-anchor">#</a> App Three</h3> <p>正如所料，<strong>App Three</strong> 看起来（和<strong>App Two</strong>）很相似。但是，它不消费来自 <strong>App one</strong> 的独立自运行的组件 <code>&lt;App&gt;</code> （没有导航栏或侧边栏），因此，它并未指定任何 “remote”：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;app_three_remote&quot;</span><span class="token punctuation">,</span>
  library<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;var&quot;</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&quot;app_three_remote&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  filename<span class="token operator">:</span> <span class="token string">&quot;remoteEntry.js&quot;</span><span class="token punctuation">,</span>
  exposes<span class="token operator">:</span> <span class="token punctuation">{</span>
    Button<span class="token operator">:</span> <span class="token string">&quot;./src/Button&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  shared<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="浏览器中的最终结果（不同于第一个视频）"><a href="#浏览器中的最终结果（不同于第一个视频）" class="header-anchor">#</a> 浏览器中的最终结果（不同于第一个视频）</h2> <p>请重点关注 network 标签页，来自三个不同服务器的代码正在被整合（federated），三个不同的 bundles，我们一般建议不要 federate 整个应用的容器，除非你正享受 SSR 或者渐进式加载带来的好处。不管怎么说，这个概念简直太强大了。</p> <p align="center" class="card-link"><a target="_blank" href="https://twitter.com/ScriptedAlchemy/status/1234383702433468416?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed&amp;ref_url=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Ftype%3Dtext%252Fhtml%26key%3Da19fcc184b9711e1b4764040d3dc5c07%26schema%3Dtwitter%26url%3Dhttps%253A%2F%2Ftwitter.com%2Fscriptedalchemy%2Fstatus%2F1234383702433468416%26image%3Dhttps%253A%2F%2Fpbs.twimg.com%2Fext_tw_video_thumb%2F1234383371863617536%2Fpu%2Fimg%2FlQ-uregGFW3TExzi.jpg"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/zack-jackson-tweet-2.d2caba60.png" width="500"></a></p> <h3 id="代码冗余"><a href="#代码冗余" class="header-anchor">#</a> 代码冗余</h3> <p>这里几乎没有任何依赖冗余，通过 <code>shared</code> 选项 —— <strong>remotes 将会首先依赖来自 host 的依赖，如果 host 没有依赖，它将会下载自己的依赖。没有代码层面的冗余，而只有内置的冗余。</strong></p> <p align="center" class="card-link"><a target="_blank" href="https://twitter.com/ScriptedAlchemy/status/1233996827814322178?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed&amp;ref_url=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Ftype%3Dtext%252Fhtml%26key%3Da19fcc184b9711e1b4764040d3dc5c07%26schema%3Dtwitter%26url%3Dhttps%253A%2F%2Ftwitter.com%2Fscriptedalchemy%2Fstatus%2F1233996827814322178%26image%3Dhttps%253A%2F%2Fi.embed.ly%2F1%2Fimage%253Furl%253Dhttps%25253A%25252F%25252Fpbs.twimg.com%25252Fprofile_images%25252F1006614185093091337%25252FOAPr0bpP_400x400.jpg%2526key%253Da19fcc184b9711e1b4764040d3dc5c07"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/zack-jackson-tweet-3.fc6da9b9.png" width="500"></a></p> <p>然而手动地增加 vendors 或其他用于<code>共享</code>的模块并不利于拓展，你可以自定义一个函数或者相应的 Webpack 插件来实现自动化。我们的确计划发布 <code>AutomaticModuleFederationPlugin</code>，并且在 Webpack Core 之外去维护它。既然我们在 Webpack 中已经有了相当好的 code federation 支持，拓展它的功能就不值一提了。</p> <p>那么大问题来了… 上面说的这些支持 SSR 吗？？</p> <iframe src="https://giphy.com/embed/3oz8xwNlejeJDQREic" width="100%" height="400" frameBorder="0" allowFullScreen="" class="giphy-embed"></iframe><p></p> <h2 id="服务端渲染"><a href="#服务端渲染" class="header-anchor">#</a> 服务端渲染</h2> <p>我们将其设计成了可以在任何环境下工作的 “通用模块 Federation”，服务端渲染 federated code 是完全可行的，只要让服务器构建使用一个 <code>commonjs</code> 的 library target。实现 federated SSR 有很多种办法，S3 Streaming, ESI, 自动化一个 npm 发布去消费服务器的变化内容，我计划用一个常用的共享文件的 volume 或者移步的 S3 streaming 来跨文件系统传输文件。让服务器能够像在浏览器中一样去 require federated code，使用 fs 而不是 http 来加载 federated code。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
 plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   name<span class="token operator">:</span> <span class="token string">&quot;container&quot;</span><span class="token punctuation">,</span>
   library<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;commonjs-module&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   filename<span class="token operator">:</span> <span class="token string">&quot;container.js&quot;</span><span class="token punctuation">,</span>
   remotes<span class="token operator">:</span> <span class="token punctuation">{</span>
    containerB<span class="token operator">:</span> <span class="token string">&quot;../1-container-full/container.js&quot;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   shared<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><iframe src="https://giphy.com/embed/aNZjVWeD1hBCg" width="100%" height="400" frameBorder="0" allowFullScreen="" class="giphy-embed"></iframe><p></p> <blockquote class="highlight"><p>“Module Federation 当然也适用于 <code>target: &quot;node&quot;</code>，这里使用指向其他微前端应用的文件路径，而不是 URLs。这样的话你就可以用同样的代码，外加不一样的 Webpack 配置来在 Node.js 中实现 SSR. Module Federation 的特性在 Node.js 中保持不变，如独立构建、独立部署。—— Tobias Koppers</p></blockquote> <h2 id="federated-next-js-on-webpack-5"><a href="#federated-next-js-on-webpack-5" class="header-anchor">#</a> Federated Next.js on Webpack 5</h2> <p>Federation 依赖 Webpack 5 —— Next 并未官方支持。不过我已经 fork Next.js，并设法升级它以支持 Webpack 5 了！这项工作仍在进行中，还有一些开发模式下的中间件需要完成。生产模式已经搞定了，但某些附加的 loaders 仍然需要重新测试。</p> <p><a href="https://github.com/module-federation/next.js/pull/2" target="_blank" rel="noopener noreferrer">feat: Upgrade Next.js to Webpack 5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p align="center" class="card-link"><a target="_blank" href="https://twitter.com/ScriptedAlchemy/status/1234373741246730241?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed&amp;ref_url=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Ftype%3Dtext%252Fhtml%26key%3Da19fcc184b9711e1b4764040d3dc5c07%26schema%3Dtwitter%26url%3Dhttps%253A%2F%2Ftwitter.com%2Fscriptedalchemy%2Fstatus%2F1234373741246730241%26image%3Dhttps%253A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1006614185093091337%2FOAPr0bpP_400x400.jpg"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/zack-jackson-tweet-4.e3f9e600.png" width="500"></a></p> <h3 id="talks-podcasts-or-feedback"><a href="#talks-podcasts-or-feedback" class="header-anchor">#</a> Talks, podcasts, or feedback</h3> <p>我非常想有和大家分享这项技术的机会，如果你想要使用 <code>Module Federation</code> 或者 <code>Federated architecture</code>，我们想要听到你的使用经历以及对现有的架构的调整。我们也非常期望能够有机会在 Podcasts、meetups 或者 corporations 中讨论它。你可以通过 <a href="https://twitter.com/ScriptedAlchemy" target="_blank" rel="noopener noreferrer">Twitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 联系到我。</p> <p align="center" class="card-link"><p><a href="https://twitter.com/ScriptedAlchemy" target="_blank" rel="noopener noreferrer"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/zack-jackson.394798df.png" alt=""><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></p> <p>你还可以联系我的联合创作者，来了解 Module Federation 的最新变化、FOSA (Federation of Standalone Applications) 架构，以及我们正在做的其他工具 —— 用于和 Federated Applications 共用的工具。</p> <p align="center" class="card-link"><p><a href="https://twitter.com/codervandal" target="_blank" rel="noopener noreferrer"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/marais.47b61a05.png" alt=""><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></p> <h2 id="使用-module-federation-的例子"><a href="#使用-module-federation-的例子" class="header-anchor">#</a> 使用 Module Federation 的例子</h2> <p>社区对 Module Federation 的反馈非常热烈！我和我的创作者们的大部分时间，都集中在将这项特性写到 Webpack 5 中，当我们忙于完成剩余特性，以及书写文档时，希望这些代码示例能对你有帮助。</p> <p align="center" class="card-link"><p><a href="https://dev.to/marais/webpack-5-and-module-federation-4j1i" target="_blank" rel="noopener noreferrer"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/example-1.82bb8503.png" alt=""><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></p> <p>因为我们有带宽，所以我们将创建一些 SSR 示例和更全面的 demo，如果有人想建设可以作为 demo 使用的东西 —— 我们很乐意接受提交给 <code>webpack-external-import</code> 的 pull requests。</p> <p align="center" class="card-link"><p><a href="https://github.com/module-federation/module-federation-examples" target="_blank" rel="noopener noreferrer"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/example-2.a2d4dddd.png" alt=""><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></p> <p align="center" class="card-link"><p><a href="https://github.com/module-federation/module-federation-examples" target="_blank" rel="noopener noreferrer"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/example-3.d6dd39a9.png" alt=""><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></p> <p align="center" class="card-link"><p><a href="https://github.com/ScriptedAlchemy/webpack-external-import" target="_blank" rel="noopener noreferrer"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/example-4.ff879f44.png" alt=""><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></p> <p>感谢 Tobias Koppers.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="custom-page-bottom"><div class="comments-wrapper"><div class="valine-wrapper"><div id="valine"></div></div></div> <div class="recommend"><h3>
    更多阅读
    <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11133" class="icon" style="width: 1.1em; height: 1.1em; position: relative; bottom: 5px; vertical-align: middle;fill: currentColor;overflow: hidden;"><path d="M357.824 841.088v-2.944c0.064-7.04 0.32-13.952 0.128-20.928a103.552 103.552 0 0 0-21.184-58.304c-6.016-7.808-13.376-14.336-20.288-21.312-4.864-5.184-4.8-5.184-9.536-10.432a294.848 294.848 0 0 1-61.184-113.664 307.072 307.072 0 0 1-1.088-161.088c10.112-37.76 27.584-73.536 51.52-104.448 12.352-16 26.432-30.656 41.92-43.648a270.592 270.592 0 0 1 68.352-41.856 255.872 255.872 0 0 1 93.312-20.16c7.104-0.128 7.04-0.128 14.144 0a256.448 256.448 0 0 1 80.768 15.232c18.944 6.848 37.12 15.936 54.016 26.88a288.832 288.832 0 0 1 118.4 161.216c11.712 40.128 14.976 82.752 9.664 124.288a297.792 297.792 0 0 1-53.696 136.768c-7.04 9.728-14.72 19.008-22.912 27.776-5.632 6.016-11.776 11.584-17.408 17.664-2.304 2.56-4.48 5.248-6.592 8-12.16 17.152-18.88 36.8-19.712 57.792a2796.16 2796.16 0 0 0-0.256 23.168c16.704 0.512 33.344 1.024 50.048 1.664 3.968 0.448 7.68 1.472 11.136 3.52a25.92 25.92 0 0 1 6.016 39.04 26.304 26.304 0 0 1-17.152 8.512c-35.968 1.344-72 2.368-107.968 3.008l-0.448 5.44a94.08 94.08 0 0 1-8.576 30.336c-12.992 26.88-38.976 46.208-68.48 50.752a91.84 91.84 0 0 1-72.064-19.84 91.776 91.776 0 0 1-32.768-61.248c-0.192-1.792-0.384-3.584-0.448-5.44a5518.592 5518.592 0 0 1-108.032-3.008 27.392 27.392 0 0 1-11.136-3.52 25.92 25.92 0 0 1-6.016-39.04 26.496 26.496 0 0 1 17.152-8.512c16.768-0.64 33.6-1.216 50.368-1.664z m109.12 56.384l0.192 1.664a42.432 42.432 0 0 0 12.672 23.616 40.704 40.704 0 0 0 54.08 0 40.64 40.64 0 0 0 12.864-25.28 5528.96 5528.96 0 0 1-79.808 0z m138.048-57.6l0.256-23.36a154.624 154.624 0 0 1 29.632-86.592c7.04-9.664 15.424-17.856 23.872-26.24 4.032-4.224 4.032-4.224 8-8.576a245.632 245.632 0 0 0 56.128-112.832 255.616 255.616 0 0 0-1.92-110.976 242.112 242.112 0 0 0-62.144-112.832 218.944 218.944 0 0 0-76.48-50.88 206.72 206.72 0 0 0-119.744-9.408 210.688 210.688 0 0 0-69.76 29.248 228.928 228.928 0 0 0-62.72 60.864 245.12 245.12 0 0 0-38.72 88.704 255.36 255.36 0 0 0 0.64 110.72 243.84 243.84 0 0 0 61.312 114.304c4.48 4.608 9.216 8.96 13.696 13.568a156.672 156.672 0 0 1 39.296 75.968c1.792 9.088 2.624 18.304 2.88 27.584l-0.128 20.736a5260.672 5260.672 0 0 1 195.904 0z m-416-498.944a25.664 25.664 0 0 1 23.232 34.112 24.96 24.96 0 0 1-4.864 8.256 25.024 25.024 0 0 1-18.368 8.768c-26.496 0.448-53.184 2.176-79.616-0.128a25.6 25.6 0 0 1-9.152-48.192 26.88 26.88 0 0 1 10.88-2.816c25.984-0.448 51.904-0.448 77.888 0z m723.904 0a25.024 25.024 0 0 1 18.368 8.768 25.792 25.792 0 0 1-18.368 42.368c-26.496 0.448-53.184 2.176-79.616-0.128a25.6 25.6 0 0 1-9.152-48.192 26.88 26.88 0 0 1 10.88-2.816c25.984-0.448 51.904-0.448 77.888 0z m-143.808-216.96a25.856 25.856 0 0 1 11.328 2.88 25.92 25.92 0 0 1 12.16 31.552 26.24 26.24 0 0 1-5.44 8.704c-18.432 19.008-35.904 39.488-56.512 56.32a25.728 25.728 0 0 1-41.472-18.816 25.984 25.984 0 0 1 6.976-18.816c18.432-19.008 35.904-39.552 56.512-56.32a27.648 27.648 0 0 1 10.56-4.992 26.176 26.176 0 0 1 5.888-0.512z m-524.544 0c6.016 0.256 11.52 2.496 16.128 6.464 19.712 18.112 39.872 36.224 56.832 57.024a26.688 26.688 0 0 1 5.312 19.392 25.92 25.92 0 0 1-32.832 20.992 25.6 25.6 0 0 1-10.112-5.888c-19.008-18.496-39.488-35.968-56.32-56.512a25.792 25.792 0 0 1 20.992-41.472zM507.712 39.616a25.6 25.6 0 0 1 24.64 22.976c2.304 27.008 2.304 54.336 0 81.344a25.792 25.792 0 0 1-48.256 9.152 26.88 26.88 0 0 1-2.816-10.88c-0.448-26.56-2.176-53.184 0.128-79.616a27.712 27.712 0 0 1 2.304-8.384c4.16-8.64 12.8-14.08 22.272-14.592h1.728z" fill="#515151" p-id="11134"></path></svg></h3> <div class="recommend-page"><a href="/about/" class="nav-link">About</a></div><div class="recommend-page"><a href="/team/" class="nav-link">和喜欢的人一起，做人人都喜欢的产品</a></div><div class="recommend-page"><a href="/blog/2019/12/21/explore-the-way-of-real-time-build-based-on-browser/" class="nav-link">基于浏览器的实时构建探索之路</a></div></div></div></main></div><div class="global-ui"><div class="cat-container" data-v-a13867c0><canvas id="vuepress-cat" width="280" height="250" class="live2d" data-v-a13867c0></canvas></div><!----></div></div>
    <script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/app.07ace312.js" defer></script><script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/6.7e6d8c60.js" defer></script><script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/1.99a6a48f.js" defer></script><script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/8.c2ec29c0.js" defer></script><script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/14.0d652d66.js" defer></script><script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/12.edba1657.js" defer></script>
  </body>
</html>
